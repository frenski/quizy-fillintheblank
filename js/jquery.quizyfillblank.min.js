Array.indexOf||(Array.prototype.indexOf=function(e){for(var t=0;t<this.length;t++)if(this[t]==e)return t;return-1}),function(e){e.fn.quizyFillBlank=function(t){var n,a=e.extend({},e.fn.quizyFillBlank.defaults,t),r=a.textItems,s=a.anItemsCorrect,l=a.anItems,i=l.length,o=s.length,d=0,c=0,f=0,u=!1,p=e("#"+a.elementAnId),h=e("#"+a.elementTextId),g={},b={};function m(){return"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0}function v(t,n){if(n.draggable("option","disabled")){var r=n.attr("id"),l=r.substring(a.answerId.length,r.length),i=b[parseInt(l)],o=e("#"+a.phId+i);n.draggable("enable"),n.draggable("option","revert",!0),n.removeClass("quizy-fitb-dropelement-disabled"),n.offset(g[r]),o.droppable("enable"),d--,b[parseInt(l)]=null,s[i]==l&&(e("#"+a.checkId+l).addClass("quizy-fitb-res-no").removeClass("quizy-fitb-res-yes"),e("#"+a.checkId+l).html("x"),f--)}}function I(t,r){r.droppable("disable"),t.addClass("quizy-fitb-dropelement-disabled"),t.draggable("disable"),t.position({of:r,my:"left top",at:"left top"}),t.draggable("option","revert",!1);var l=r.attr("id"),i=l.substring(a.phId.length,l.length),p=(l=t.attr("id")).substring(a.answerId.length,l.length);if(s[i]==p&&(e("#"+a.checkId+p).removeClass("quizy-fitb-res-no").addClass("quizy-fitb-res-yes"),e("#"+a.checkId+p).html("&#10003"),f++),b[parseInt(p)]=parseInt(i),u||(n=setInterval(k,1e3),u=!0),++d==o&&(clearInterval(n),e("."+a.checkId).fadeIn(),e("."+a.numberId).fadeIn(),""!=a.onFinishCall&&a.onFinishCall({correct_answers:f,all_answers:o,time:c}),e(".draggable-element").off("click"),m()))for(var h=document.getElementsByClassName("draggable-element"),g=0;g<h.length;g++)w(h[g],"touchstart",y,!0)}function y(t){var n=t.target.getAttribute("id"),r=n.substring(a.answerId.length,n.length),s=b[parseInt(r)],l=e("#"+n);if(null===s){for(var i=0;i<o;i++)if(-1==Object.values(b).indexOf(i)){s=i;break}var d=e("#"+a.phId+s),c=parseInt(l.offset().left),f=parseInt(l.offset().top);g[n]={top:f,left:c},l.offset({top:d.offset.top,left:d.offset.left}),I(l,d)}else v(event,l)}var k=function(){c++};function x(e,t,n,a){e.addEventListener?e.addEventListener(t,n,a):e.attachEvent&&e.attachEvent("on"+t,n)}function w(e,t,n,a){e.removeEventListener?e.removeEventListener(t,n,a):e.detachEvent&&e.detachEvent("on"+t,n)}function z(t){var n=t.changedTouches[0],a="";switch(t.type){case"touchstart":a="mousedown";break;case"touchmove":a="mousemove";break;case"touchend":a="mouseup";break;default:return}var r=document.createEvent("MouseEvent");r.initMouseEvent(a,!0,!0,window,1,n.screenX,n.screenY,n.clientX,n.clientY,!1,!1,!1,!1,0,null),n.target.dispatchEvent(r),(e(t.target).hasClass("draggable-element")||e(t.target).parent().hasClass("draggable-element"))&&t.preventDefault()}for(var C=0;C<o;C++)if(h.append("<span>"+r[C]+'</span> <span id="'+a.phId+C+'" style="width:'+a.blockSize+"px; height:"+a.blockSizeHeight+'px; " class="droppable-element quizy-fitb-droptarget"></span>'),C==o-1){var q=C+1;h.append("<span>"+r[q]+"</span>")}var E=p;for(C=0;C<i;C++)E.append('<div id="'+a.answerId+C+'" class="quizy-fitb-answer draggable-element quizy-fitb-dropelement" style="width:'+a.blockSize+"px; height: "+a.blockSizeHeight+'px;">'+l[C]+"</div>"),e("#"+a.answerId+C).append('<div id="'+a.checkId+C+'" class="quizy-fitb-res quizy-fitb-res-no '+a.checkId+'">x</div>'),e("#"+a.answerId+C).append('<div id="'+a.numberId+C+'" class="quizy-fitb-res quizy-fitb-res-num '+a.checkId+'">'+(parseInt(s.indexOf(C))+1)+"</div>"),b[C]=null;if(e(".draggable-element").draggable({cursor:"move",containment:"document",stop:function(e,t){parseInt(t.offset.left),parseInt(t.offset.top)},start:function(t,n){var a=parseInt(n.offset.left),r=parseInt(n.offset.top);g[e(this).attr("id")]={top:r,left:a}},revert:!0}),e(".draggable-element").on("click",(function(t){v(0,e(this))})),e(".droppable-element").droppable({drop:function(t,n){var a=e(this);I(n.draggable,a)},hoverClass:"quizy-fitb-droptarget-hover"}),m())if(a.allowTouchDrag)x(document,"touchstart",z,!0),x(document,"touchmove",z,!0),x(document,"touchend",z,!0),x(document,"touchcancel",z,!0);else{e(".draggable-element").off("click");var T=document.getElementsByClassName("draggable-element");for(C=0;C<T.length;C++)x(T[C],"touchstart",y,!0)}for(C=0;C<i;C++)e("#"+a.checkId+C).position({of:e("#"+a.answerId+C),my:"right center ",at:"right center",offset:"0 5px"}),e("#"+a.numberId+C).position({of:e("#"+a.answerId+C),my:"right center",at:"right center",offset:"10px -10px"}),e("#"+a.checkId+C).hide(),e("#"+a.numberId+C).hide();""!=a.onLoadCall&&a.onLoadCall()},e.fn.quizyFillBlank.defaults={elementAnId:"fillblank-ph",textItems:["Text part1","text part 2","text part 3"],elementTextId:"fillblank-text",anItems:["an1","an2","an3"],anItemsCorrect:[2,0],answerId:"d-answer",phId:"d-nest",checkId:"d-check",numberId:"d-number",blockSize:100,blockSizeHeight:20,onFinishCall:"",onLoadCall:"",allowTouchDrag:!1}}(jQuery);
